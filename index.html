<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' http://* 'unsafe-inline' 'unsafe-eval'" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORM</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <form>
        <input type="text" id="first_name" placeholder="Nom">
        <input type="text"  id="score" placeholder="Score">
        <button type="submit">Add User</button>
    </form>

    <div id="displayuser"></div>

    <script>
        const user_section = document.querySelector('#displayuser')
        const form = document.querySelector('form');

        form.addEventListener('submit', event => {
            event.preventDefault();
            const name = document.querySelector('#first_name').value;
            const score = document.querySelector('#score').value;
            addUser(name, score);
               
        });

        function addUser(name, score){
            axios.post('http://localhost:1337/api/classements', {
                data:{
                    nom: name,
                    total_score: score
                }
            })
            .then((response) => {console.log(response);}, 
            (error) => {console.log(error);});
            sortUser()
        }

        function sortUser(){
            var usersArr = []
            axios.get('http://localhost:1337/api/classements', {})
            .then(function (response) {
                user_section.innerHTML = '';
                response.data.data.forEach(item => {
                    const name = item.attributes.nom
                    const score = item.attributes.total_score
                    usersArr.push({name, score})
                });

                usersArr.sort((a, b) => a.score - b.score);
                usersArr = usersArr.reverse();
                user_section.innerHTML = '';
                usersArr.forEach(item => {
                    user_section.innerHTML += '<span class="user_span">'+item.name+' '+item.score+'</span><br/>';
                });
            })
        }

        sortUser()  
    </script>
</body>
</html>